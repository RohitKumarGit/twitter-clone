<template>
    <div class="wrap">
       <b-modal v-model="chooseHandle" :can-cancel="false" has-modal-card  :destroy-on-hide="false" aria-role="dialog" aria-modal>
    <template #default="props">

               <choose-handle  @close="props.close" ></choose-handle>
            </template>

    </b-modal>
        <div class="wrap-left"></div>
         <div class="wrap-right">
            <div class="wrap-right_form">
                <h1 class="head">Login to your account</h1>
                <div class="twiter-btn">
                
                     <b-button :loading="loading" v-on:click="login" size="is-medium"   class="login_btn" type="is-primary shadow-sm" rounded>
<svg v-if="!loading" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"
width="40" height="40"
viewBox="0 0 172 172"
style=" fill:#000000;"><g fill="none" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><path d="M0,172v-172h172v172z" fill="none"></path><g><path d="M55.6893,151.32345c-16.52705,0 -32.6542,-4.31935 -46.9259,-12.5302c1.17605,0.0602 2.3564,0.0903 3.53675,0.0903c15.5015,0 30.12795,-5.04175 42.29695,-14.57915l2.3779,-1.86405l-3.0229,-0.0559c-13.29775,-0.24725 -25.026,-8.55485 -29.7259,-20.85715c1.56735,0.215 3.139,0.32035 4.6913,0.32035c3.09815,0 6.16835,-0.4085 9.1203,-1.21475l4.3817,-1.19755l-4.4548,-0.8944c-14.63505,-2.9369 -25.37645,-15.62405 -25.99995,-30.4526c4.3645,2.1285 9.18265,3.32605 14.0438,3.483l3.7582,0.1204l-3.1261,-2.0898c-9.0386,-6.0415 -14.43295,-16.13575 -14.43295,-27.0083c0,-5.2202 1.25345,-10.35655 3.63995,-14.95325c17.2215,20.425 42.22815,32.8649 68.86235,34.1979l1.42115,0.07095l-0.3182,-1.38675c-0.5547,-2.408 -0.83635,-4.89555 -0.83635,-7.396c0,-17.8923 14.55765,-32.44995 32.4478,-32.44995c8.94185,0 17.5741,3.73455 23.68655,10.2469l0.40635,0.4343l0.5848,-0.1161c6.68005,-1.31365 13.08275,-3.60555 19.07265,-6.82195c-2.64665,6.4113 -7.0649,11.5928 -12.9,15.0887l-0.86,0.51385l0.79765,1.56735l0.80625,0.0258c5.418,-0.6622 10.57155,-1.93715 15.65415,-3.88075c-4.04415,5.39005 -8.8537,10.1136 -14.3319,14.07175l-0.4687,0.33755l0.02365,0.5805c0.0602,1.42115 0.09245,2.8552 0.09245,4.28925c0.0043,46.3583 -35.27075,94.30975 -94.299,94.30975z" fill="#ffffff"></path><path d="M117.42655,21.75155c8.64515,0 16.9936,3.612 22.9018,9.9072l0.81485,0.8686l1.16745,-0.23005c5.7534,-1.13305 11.30255,-2.97775 16.5636,-5.50185c-2.60365,4.9192 -6.3898,8.93755 -11.15205,11.7906l-1.72645,1.03415l0.91805,1.79095l0.0602,0.1161l0.6837,1.33515l1.48995,-0.18275c4.25055,-0.5203 8.33985,-1.4104 12.3625,-2.69825c-3.4658,4.1151 -7.41535,7.783 -11.7992,10.9521l-0.9374,0.67725l0.04945,1.1567c0.06235,1.4534 0.09245,2.881 0.09245,4.24625c0,22.63735 -8.75695,45.5585 -24.0284,62.8832c-12.2034,13.846 -34.11405,30.35155 -69.1999,30.35155c-14.8737,0 -29.41845,-3.53675 -42.5485,-10.2942c15.4327,-0.17845 29.98175,-5.289 42.1185,-14.8049l4.75795,-3.73025l-6.04365,-0.1118c-12.25285,-0.2279 -23.12755,-7.53145 -28.05535,-18.51365c1.00405,0.086 2.00595,0.129 3.0014,0.129c3.1992,0 6.364,-0.4214 9.4041,-1.25345l8.75695,-2.3951l-8.901,-1.78665c-13.5622,-2.7219 -23.6672,-14.104 -25.0131,-27.6705c4.0463,1.71785 8.4108,2.6875 12.8097,2.8294l7.51425,0.24295l-6.2522,-4.17745c-8.7376,-5.84155 -13.95565,-15.60255 -13.95565,-26.1139c0,-4.5064 0.9675,-8.9483 2.81435,-13.0118c17.36985,19.909 42.17655,32.0092 68.5592,33.33145l2.8423,0.1419l-0.63855,-2.7735c-0.5375,-2.3306 -0.81055,-4.7386 -0.81055,-7.1552c0.00645,-17.30535 14.08035,-31.37925 31.37925,-31.37925M117.42655,19.60155c-18.5115,0 -33.52495,15.01345 -33.52495,33.52495c0,2.6273 0.29885,5.18795 0.8643,7.63895c-27.85755,-1.39535 -52.5589,-14.74685 -69.0967,-35.02995c-2.881,4.9493 -4.53435,10.70915 -4.53435,16.85815c0,11.62935 5.9168,21.88915 14.91025,27.90055c-5.49325,-0.1763 -10.66185,-1.6813 -15.1833,-4.19465c0,0.14405 0,0.2795 0,0.4214c0,16.2454 11.5541,29.79255 26.8922,32.87135c-2.8122,0.7697 -5.77275,1.1782 -8.8365,1.1782c-2.1586,0 -4.2613,-0.2107 -6.3038,-0.59985c4.2699,13.3171 16.64745,23.01145 31.31905,23.2845c-11.4724,8.99345 -25.92685,14.35125 -41.6326,14.35125c-2.70255,0 -5.37285,-0.15695 -8.00015,-0.47085c14.835,9.5116 32.4564,15.06075 51.3893,15.06075c61.662,0 95.3783,-51.084 95.3783,-95.38475c0,-1.4491 -0.0344,-2.90035 -0.0946,-4.33655c6.5489,-4.73 12.2335,-10.6339 16.727,-17.35265c-5.9555,2.6445 -12.1002,4.4032 -18.8125,5.2245l-0.0602,-0.1161c6.92515,-4.14735 11.85295,-10.5479 14.3577,-18.3782c-6.47365,3.8399 -13.65035,6.6306 -21.2893,8.1356c-6.11245,-6.5145 -14.82855,-10.5866 -24.46915,-10.5866z" fill="#7496c4"></path></g></g></svg>
                     <span class="is-block">login</span></b-button>
                </div>
            </div>
         </div>
    </div>
</template>
<script>
import chooseHandle from '@/components/chooseHandle'
import firebase from 'firebase'
var provider = new firebase.auth.GoogleAuthProvider();
import axios from 'axios'
export default {
    data(){
        return {
            chooseHandle:false,
            loading:false,
            
        }
    },
    components:{
        chooseHandle
    },
    methods:{
        async login(){
            this.loading = true
            try {
                const {user} = await firebase.auth().signInWithPopup(provider)
                const {data} = await axios.post("/user/verify/uid",{
                    uid:user.uid
                })
               
                
                if(data.exists){
                    window.location = '/'
                }
                else {
                    this.chooseHandle = true
                }
                this.loading = false
            } catch (error) {
                this.$buefy.snackbar.open({
                    message: 'Something unexpected',
                    type: 'is-warning',
                    position: 'is-top',
                    actionText: 'Retry',
                    indefinite: true,
                    onAction: () => {
                        this.login()
                    }
                })
            }
            

        }
       
    }
}
</script>>